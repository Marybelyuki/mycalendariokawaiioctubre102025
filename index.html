<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🦄 Kawaii Planner 💖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22 viewBox=%220 0 24 24%22><text y=%2220%22 font-size=%2220%22>🦄</text></svg>"), auto;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(-15%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); } }
        @keyframes pulse { 50% { opacity: .5; } }
        .animate-bounce { animation: bounce 1.5s infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .hidden { display: none; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 p-4">

    <div class="fixed top-10 left-10 text-5xl animate-bounce z-0">🦄</div>
    <div class="fixed top-20 right-20 text-4xl animate-pulse z-0">⭐</div>
    <div class="fixed bottom-20 left-20 text-4xl animate-bounce z-0">🌈</div>
    <div class="fixed bottom-10 right-10 text-5xl animate-pulse z-0">✨</div>
    
    <div id="app-container" class="max-w-7xl mx-auto relative z-10">
        <header class="bg-white rounded-3xl shadow-xl p-6 mb-6 border-4 border-pink-300 relative overflow-hidden">
            <div class="absolute top-0 left-0 text-8xl opacity-10">🦄</div>
            <div class="absolute bottom-0 right-0 text-7xl opacity-10">💝</div>
            <div class="flex flex-col xl:flex-row items-center justify-between relative z-10 gap-4">
                <div>
                    <h1 class="text-4xl lg:text-5xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent mb-2">Kawaii Planner</h1>
                    <div class="flex items-center gap-3">
                        <button id="prev-btn" class="bg-pink-200 text-pink-600 p-2 rounded-full hover:bg-pink-300 transition" aria-label="Anterior">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                        <p id="current-date-display" class="text-purple-500 font-bold text-lg text-center w-80">Cargando...</p>
                        <button id="next-btn" class="bg-pink-200 text-pink-600 p-2 rounded-full hover:bg-pink-300 transition" aria-label="Siguiente">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-3 items-center">
                    <div id="view-switcher" class="flex gap-2 bg-gradient-to-r from-pink-100 to-purple-100 p-2 rounded-2xl border-2 border-pink-300">
                         <button data-view="daily" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">📅 Diario</button>
                         <button data-view="weekly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">📆 Semanal</button>
                         <button data-view="monthly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">🗓️ Mensual</button>
                         <button data-view="yearly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">🎊 Anual</button>
                    </div>
                    <button id="export-btn" class="bg-gradient-to-r from-pink-400 to-blue-400 text-white px-6 py-3 rounded-full font-bold flex items-center gap-2 shadow-xl transform hover:scale-105 transition">
                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                         Descargar
                    </button>
                </div>
            </div>
        </header>

        <main>
            <div id="daily-view" class="view-container grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="space-y-6">
                    <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-cyan-200 relative overflow-hidden">
                        <h2 class="text-2xl font-bold text-teal-500 mb-4 flex items-center gap-2">Objetivos del Día <span class="text-2xl">🎯</span></h2>
                        <textarea id="goals-textarea" class="w-full h-24 p-3 rounded-2xl border-2 bg-cyan-50" placeholder="¿Qué quieres lograr hoy? ✨"></textarea>
                    </div>
                    <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-pink-200 relative overflow-hidden">
                        <h2 class="text-2xl font-bold text-pink-500 mb-4 flex items-center gap-2">To-Do List <span class="text-2xl">📝</span></h2>
                        <div class="space-y-3 mb-4">
                            <input type="text" id="task-input" class="w-full p-3 rounded-2xl border-2" placeholder="Nueva tarea... 💕">
                            <div class="flex gap-2">
                                <select id="priority-select" class="flex-1 p-2 rounded-xl border-2 text-sm"><option value="high">⭐ Alta</option><option value="medium">💖 Media</option><option value="normal" selected>☁️ Normal</option></select>
                                <button id="add-task-btn" class="bg-gradient-to-r from-pink-400 to-pink-500 text-white px-6 py-2 rounded-xl font-bold flex items-center gap-2 shadow-lg">✨</button>
                            </div>
                        </div>
                        <div id="tasks-container" class="space-y-2 max-h-96 overflow-y-auto"></div>
                    </div>
                </div>
                <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-purple-200 relative overflow-hidden">
                     <h2 class="text-2xl font-bold text-purple-500 mb-4 flex items-center gap-2">Horario <span class="text-2xl">⏰</span></h2>
                     <div class="space-y-3 mb-4">
                        <div class="flex gap-2"><input type="time" id="event-start-time" class="w-28 p-2 rounded-xl border-2"><input type="time" id="event-end-time" class="w-28 p-2 rounded-xl border-2"></div>
                        <div class="flex gap-2"><input type="text" id="event-text-input" class="flex-1 p-2 rounded-xl border-2" placeholder="Evento... 🎉"><button id="add-event-btn" class="bg-gradient-to-r from-purple-400 to-pink-400 text-white px-4 py-2 rounded-xl shadow-lg">+</button></div>
                     </div>
                     <div id="schedule-container" class="space-y-1 max-h-[600px] overflow-y-auto"></div>
                </div>
                <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-cyan-200 relative overflow-hidden">
                    <h2 class="text-2xl font-bold text-teal-500 mb-4 flex items-center gap-2">Notas <span class="text-2xl">📔</span></h2>
                    <textarea id="notes-textarea" class="w-full h-full min-h-[500px] p-4 rounded-2xl border-2 bg-cyan-50" placeholder="Escribe tus pensamientos aquí... 🌟"></textarea>
                </div>
            </div>

            <div id="weekly-view" class="view-container hidden">
                 <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-pink-200 overflow-hidden">
                    <div id="weekly-grid" class="grid grid-cols-8 auto-rows-fr gap-1 text-center text-sm">
                        </div>
                </div>
            </div>

            <div id="monthly-view" class="view-container hidden">
                <div class="bg-white rounded-3xl shadow-lg p-6 border-4 border-cyan-200 overflow-hidden">
                    <div id="monthly-grid-header" class="grid grid-cols-7 gap-2 mb-2"></div>
                    <div id="monthly-grid-days" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>

            <div id="yearly-view" class="view-container hidden">
                <div id="yearly-grid" class="bg-white rounded-3xl shadow-lg p-6 border-4 border-blue-200 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    </div>
            </div>
        </main>
    </div>

    <script>
        // --- ESTADO DE LA APLICACIÓN ---
        let currentDate = new Date();
        let dailyData = {};
        let currentView = 'daily'; // 'daily', 'weekly', 'monthly', 'yearly'

        // --- CONSTANTES ---
        const
            monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
            dayNames = ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"];
        
        // --- ELEMENTOS DEL DOM ---
        const
            dateDisplay = document.getElementById('current-date-display'),
            viewContainers = document.querySelectorAll('.view-container'),
            viewSwitcherBtns = document.querySelectorAll('.view-btn'),
            goalsTextarea = document.getElementById('goals-textarea'),
            notesTextarea = document.getElementById('notes-textarea'),
            taskInput = document.getElementById('task-input'),
            prioritySelect = document.getElementById('priority-select'),
            tasksContainer = document.getElementById('tasks-container'),
            scheduleContainer = document.getElementById('schedule-container'),
            eventStartTimeInput = document.getElementById('event-start-time'),
            eventEndTimeInput = document.getElementById('event-end-time'),
            eventTextInput = document.getElementById('event-text-input');

        // --- FUNCIONES DE MANEJO DE DATOS ---
        const formatDateKey = (date) => date.toISOString().split('T')[0];
        const saveData = () => localStorage.setItem('kawaiiPlannerData', JSON.stringify(dailyData));
        const loadData = () => {
            const savedData = localStorage.getItem('kawaiiPlannerData');
            if (savedData) dailyData = JSON.parse(savedData);
        };
        const getCurrentDayData = () => {
            const key = formatDateKey(currentDate);
            if (!dailyData[key]) dailyData[key] = { tasks: [], scheduleEvents: [], notes: '', goals: '' };
            return dailyData[key];
        };

        // --- LÓGICA DE LA APLICACIÓN (Agregar, borrar, etc.) ---
        const addTask = () => { /* ... (código sin cambios) ... */ };
        const toggleTask = (taskId) => { /* ... (código sin cambios) ... */ };
        const deleteTask = (taskId) => { /* ... (código sin cambios) ... */ };
        const addEvent = () => { /* ... (código sin cambios) ... */ };
        const deleteEvent = (eventId) => { /* ... (código sin cambios) ... */ };
        const exportData = () => { /* ... (código sin cambios) ... */ };

        // --- LÓGICA DE NAVEGACIÓN Y VISTAS ---
        const handleNavigation = (direction) => {
            const newDate = new Date(currentDate);
            if (currentView === 'daily') newDate.setDate(newDate.getDate() + direction);
            if (currentView === 'weekly') newDate.setDate(newDate.getDate() + 7 * direction);
            if (currentView === 'monthly') newDate.setMonth(newDate.getMonth() + direction);
            if (currentView === 'yearly') newDate.setFullYear(newDate.getFullYear() + direction);
            currentDate = newDate;
            renderApp();
        };

        const changeView = (newView) => {
            currentView = newView;
            renderApp();
        };

        // --- FUNCIONES DE RENDERIZADO (DIBUJAR LA PANTALLA) ---

        const updateDateDisplay = () => {
            if (currentView === 'daily') {
                dateDisplay.textContent = currentDate.toLocaleDateString('es-MX', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            } else if (currentView === 'weekly') {
                const startOfWeek = new Date(currentDate);
                startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);
                dateDisplay.textContent = `Semana del ${startOfWeek.getDate()} de ${monthNames[startOfWeek.getMonth()]} al ${endOfWeek.getDate()} de ${monthNames[endOfWeek.getMonth()]}`;
            } else if (currentView === 'monthly') {
                dateDisplay.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            } else if (currentView === 'yearly') {
                dateDisplay.textContent = currentDate.getFullYear();
            }
        };

        const renderDailyView = () => { /* ... (código sin cambios) ... */ };
        
        const renderWeeklyView = () => {
            const container = document.getElementById('weekly-grid');
            container.innerHTML = '';
            
            // Header (Horas)
            container.innerHTML += `<div class="font-bold p-2 text-teal-700">⏰</div>`;
            const weekDays = [];
            for (let i = 0; i < 7; i++) {
                const day = new Date(currentDate);
                day.setDate(day.getDate() - day.getDay() + i);
                weekDays.push(day);
                const isToday = day.toDateString() === new Date().toDateString();
                container.innerHTML += `<div class="p-2 rounded-lg border-2 ${isToday ? 'bg-pink-300 text-white' : 'bg-pink-100'}">${dayNames[i]}<br>${day.getDate()}</div>`;
            }

            // Filas de Horas
            for (let hour = 6; hour < 22; hour++) {
                container.innerHTML += `<div class="font-semibold p-2 bg-cyan-50 rounded-lg">${hour}:00</div>`; // Celda de la hora
                for (const day of weekDays) {
                    const key = formatDateKey(day);
                    const events = (dailyData[key]?.scheduleEvents || []).filter(e => parseInt(e.startTime.split(':')[0]) === hour);
                    let eventsHTML = '';
                    events.forEach(e => {
                        eventsHTML += `<div class="text-xs bg-purple-200 p-1 rounded mb-1">${e.text}</div>`;
                    });
                    container.innerHTML += `<div class="border border-pink-100 min-h-[40px] p-1">${eventsHTML}</div>`;
                }
            }
        };

        const renderMonthlyView = () => {
            const headerContainer = document.getElementById('monthly-grid-header');
            const daysContainer = document.getElementById('monthly-grid-days');
            headerContainer.innerHTML = '';
            daysContainer.innerHTML = '';

            dayNames.forEach(day => headerContainer.innerHTML += `<div class="font-bold text-center text-teal-700">${day}</div>`);
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();

            for (let i = 0; i < startingDay; i++) {
                daysContainer.innerHTML += `<div></div>`;
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === new Date().toDateString();
                const key = formatDateKey(date);
                const taskCount = dailyData[key]?.tasks.length || 0;
                
                let taskIndicator = taskCount > 0 ? `<div class="text-xs text-pink-500 mt-1">🌸 ${taskCount}</div>` : '';
                daysContainer.innerHTML += `
                    <div class="p-2 border-2 rounded-lg min-h-[80px] ${isToday ? 'bg-cyan-300 border-cyan-500' : 'bg-cyan-50 border-cyan-200'}">
                        <div class="font-bold ${isToday ? 'text-white' : 'text-teal-600'}">${day}</div>
                        ${taskIndicator}
                    </div>
                `;
            }
        };

        const renderYearlyView = () => {
            const container = document.getElementById('yearly-grid');
            container.innerHTML = '';
            const year = currentDate.getFullYear();
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            monthNames.forEach((name, index) => {
                const isCurrentMonth = index === currentMonth && year === currentYear;
                container.innerHTML += `
                    <div class="p-4 rounded-2xl border-2 text-center ${isCurrentMonth ? 'bg-blue-300 border-blue-500 font-bold text-white' : 'bg-blue-50 border-blue-200'}">
                        ${name}
                    </div>
                `;
            });
        };

        const renderApp = () => {
            // 1. Actualizar el display de la fecha
            updateDateDisplay();

            // 2. Gestionar qué vista se muestra
            viewContainers.forEach(container => {
                if (container.id === `${currentView}-view`) {
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                }
            });

            // 3. Actualizar el estilo de los botones de vista
            viewSwitcherBtns.forEach(btn => {
                const view = btn.dataset.view;
                const colors = { daily: 'pink', weekly: 'purple', monthly: 'cyan', yearly: 'blue' };
                if (view === currentView) {
                    btn.className = `view-btn px-3 py-2 rounded-xl font-bold transition transform bg-gradient-to-r from-${colors[view]}-400 to-${colors[view]}-500 text-white shadow-lg`;
                } else {
                    btn.className = `view-btn px-3 py-2 rounded-xl font-bold transition transform bg-white text-${colors[view]}-500 hover:bg-${colors[view]}-50`;
                }
            });

            // 4. Llamar a la función de renderizado específica para la vista actual
            if (currentView === 'daily') renderDailyView();
            if (currentView === 'weekly') renderWeeklyView();
            if (currentView === 'monthly') renderMonthlyView();
            if (currentView === 'yearly') renderYearlyView();
        };


        // --- INICIALIZACIÓN DE LA APLICACIÓN ---
        
        // Copiamos las funciones que no cambiaron para no repetir el código
        const originalAddTask = addTask;
        addTask = () => { originalAddTask(); renderApp(); };
        const originalToggleTask = toggleTask;
        toggleTask = (id) => { originalToggleTask(id); renderApp(); };
        const originalDeleteTask = deleteTask;
        deleteTask = (id) => { originalDeleteTask(id); renderApp(); };
        const originalAddEvent = addEvent;
        addEvent = () => { originalAddEvent(); renderApp(); };
        const originalDeleteEvent = deleteEvent;
        deleteEvent = (id) => { originalDeleteEvent(id); renderApp(); };
        
        // Funciones que se mantienen iguales y llaman a renderApp() al final
        const setupDailyViewFunctions = () => {
            const getPriorityColorClasses = (p) => {if (p === 'high') return 'bg-pink-100 border-pink-300'; if (p === 'medium') return 'bg-purple-100 border-purple-300'; return 'bg-blue-100 border-blue-300';};
            renderDailyView = () => {
                const { tasks, scheduleEvents, notes, goals } = getCurrentDayData();
                goalsTextarea.value = goals;
                notesTextarea.value = notes;
                tasksContainer.innerHTML = '';
                tasks.forEach(task => { const taskHTML = `<div class="p-3 rounded-2xl border-2 flex items-center gap-2 ${getPriorityColorClasses(task.priority)} ${task.completed ? 'opacity-60' : ''}"><button onclick="toggleTask(${task.id})" class="w-6 h-6 rounded-full border-2 flex items-center justify-center ${task.completed ? 'bg-pink-400' : ''}">${task.completed ? '✔️' : ''}</button><span class="flex-1 ${task.completed ? 'line-through' : ''}">${task.text}</span><button onclick="deleteTask(${task.id})" class="text-red-400">🗑️</button></div>`; tasksContainer.innerHTML += taskHTML;});
                scheduleContainer.innerHTML = '';
                Array.from({ length: 16 }, (_, i) => i + 6).forEach(hour => { const eventsAtHour = scheduleEvents.filter(e => parseInt(e.startTime.split(':')[0]) === hour); let eventsHTML = ''; eventsAtHour.forEach(e => {eventsHTML += `<div class="bg-purple-100 p-2 rounded-lg mb-1"><div>${e.startTime}-${e.endTime}</div><div>${e.text}</div><button onclick="deleteEvent(${e.id})">🗑️</button></div>`}); scheduleContainer.innerHTML += `<div class="flex gap-2"><div class="w-16">${hour}:00</div><div class="flex-1 border-t">${eventsHTML}</div></div>`;});
            };
            addTask = () => {if(taskInput.value.trim()){getCurrentDayData().tasks.push({id:Date.now(),text:taskInput.value,completed:false,priority:prioritySelect.value});taskInput.value='';saveData();renderApp();}};
            toggleTask = (id) => {const t = getCurrentDayData().tasks.find(t=>t.id===id); if(t){t.completed=!t.completed;saveData();renderApp();}};
            deleteTask = (id) => {const dayData = getCurrentDayData();dayData.tasks=dayData.tasks.filter(t=>t.id!==id);saveData();renderApp();};
            addEvent = () => {if(eventStartTimeInput.value && eventEndTimeInput.value && eventTextInput.value.trim()){getCurrentDayData().scheduleEvents.push({id:Date.now(),startTime:eventStartTimeInput.value,endTime:eventEndTimeInput.value,text:eventTextInput.value});eventStartTimeInput.value='';eventEndTimeInput.value='';eventTextInput.value='';saveData();renderApp();}};
            deleteEvent = (id) => {const dayData = getCurrentDayData();dayData.scheduleEvents=dayData.scheduleEvents.filter(e=>e.id!==id);saveData();renderApp();};
            exportData = () => {
                const data = getCurrentDayData();
                const dateStr = currentDate.toLocaleDateString('es-MX');
                let content = `🦄 PLANIFICADOR KAWAII - ${dateStr}\n\n`;
                content += `🎯 OBJETIVOS DEL DÍA:\n${data.goals || 'Sin objetivos'}\n\n`;
                content += `✅ TAREAS:\n`;
                data.tasks.forEach(task => content += `${task.completed ? '✓' : '○'} ${task.text}\n`);
                content += `\n📅 HORARIO:\n`;
                data.scheduleEvents.sort((a,b)=>a.startTime.localeCompare(b.startTime)).forEach(event => content += `${event.startTime} - ${event.endTime}: ${event.text}\n`);
                content += `\n📝 NOTAS:\n${data.notes || 'Sin notas'}`;
                const blob = new Blob([content],{type:'text/plain;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href=url; a.download=`planificador-kawaii-${dateStr.replace(/\//g,'-')}.txt`; a.click(); URL.revokeObjectURL(url);
            };
        };

        // Asignar eventos a los botones y campos de entrada
        document.getElementById('prev-btn').addEventListener('click', () => handleNavigation(-1));
        document.getElementById('next-btn').addEventListener('click', () => handleNavigation(1));
        document.getElementById('add-task-btn').addEventListener('click', () => addTask());
        document.getElementById('add-event-btn').addEventListener('click', () => addEvent());
        document.getElementById('export-btn').addEventListener('click', () => exportData());
        viewSwitcherBtns.forEach(btn => btn.addEventListener('click', () => changeView(btn.dataset.view)));

        goalsTextarea.addEventListener('input', (e) => { getCurrentDayData().goals = e.target.value; saveData(); });
        notesTextarea.addEventListener('input', (e) => { getCurrentDayData().notes = e.target.value; saveData(); });
        taskInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addTask(); });
        eventTextInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addEvent(); });

        // Cargar los datos y renderizar la aplicación por primera vez
        setupDailyViewFunctions(); // Carga las funciones que no cambiaron
        loadData();
        renderApp();
    </script>
</body>
</html>

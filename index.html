<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ñ Merakelysi Planner üíñ</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=M+PLUS+Rounded+1c:wght@400;700;800&family=Questrial&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22 viewBox=%220 0 24%22><text y=%2220%22 font-size=%2220%22>ü¶Ñ</text></svg>"), auto;
        }
        .font-luckiest-guy { font-family: 'Luckiest Guy', cursive; }
        .font-questrial { font-family: 'Questrial', sans-serif; }
        @keyframes bounce { 0%, 100% { transform: translateY(-15%); } 50% { transform: translateY(0); } }
        @keyframes pulse { 50% { opacity: .6; } }
        .animate-bounce { animation: bounce 1.8s infinite cubic-bezier(0.4, 0, 0.6, 1); }
        .animate-pulse { animation: pulse 2.2s infinite cubic-bezier(0.4, 0, 0.6, 1); }
        .hidden { display: none; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-cyan-100 p-4">

    <div class="fixed top-10 left-10 text-5xl animate-bounce z-0">ü¶Ñ</div>
    <div class="fixed top-20 right-20 text-4xl animate-pulse z-0">‚≠ê</div>
    <div class="fixed bottom-20 left-20 text-4xl animate-bounce z-0">üåà</div>
    
    <div class="max-w-7xl mx-auto relative z-10">
        <header class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 mb-6 border-4 border-pink-200 relative">
            <div class="flex flex-col xl:flex-row items-center justify-between gap-4">
                <div>
                    <h1 class="font-luckiest-guy text-5xl lg:text-6xl bg-gradient-to-r from-purple-500 to-indigo-600 bg-clip-text text-transparent mb-2 tracking-wider">Merakelysi Planner</h1>
                    <p class="text-purple-600 text-sm md:text-base font-questrial mb-2">Elaborado por: Maribel Alba Olmedo</p>
                    <div class="flex items-center gap-3">
                        <button id="prev-btn" class="bg-pink-200 text-pink-600 p-2 rounded-full hover:bg-pink-300 transition"><i data-lucide="chevron-left"></i></button>
                        <p id="current-date-display" class="text-purple-600 font-bold text-lg text-center w-80">Cargando...</p>
                        <button id="next-btn" class="bg-pink-200 text-pink-600 p-2 rounded-full hover:bg-pink-300 transition"><i data-lucide="chevron-right"></i></button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-3 items-center">
                    <div class="flex gap-2 bg-pink-100/50 p-2 rounded-2xl border-2 border-pink-200">
                        <button data-view="daily" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">üìÖ Diario</button>
                        <button data-view="weekly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">üìÜ Semanal</button>
                        <button data-view="monthly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">üóìÔ∏è Mensual</button>
                        <button data-view="yearly" class="view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105">üéä Anual</button>
                    </div>
                    <button id="export-txt-btn" class="bg-gradient-to-r from-cyan-400 to-blue-400 text-white px-4 py-3 rounded-full font-bold flex items-center gap-2 shadow-lg transform hover:scale-105 transition" title="Descargar Resumen en .txt"><i data-lucide="file-text"></i></button>
                    <button id="export-ics-btn" class="bg-gradient-to-r from-purple-400 to-pink-400 text-white px-4 py-3 rounded-full font-bold flex items-center gap-2 shadow-lg transform hover:scale-105 transition" title="Exportar Eventos a Calendario (.ics)"><i data-lucide="calendar-plus"></i></button>
                </div>
            </div>
        </header>

        <main>
            <div id="daily-view" class="view-container grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="space-y-6">
                    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-cyan-200"><h2 class="font-questrial text-2xl font-bold text-teal-500 mb-4 flex items-center gap-2"><i data-lucide="target"></i>Objetivos del D√≠a</h2><textarea id="goals-textarea" class="w-full h-24 p-3 rounded-2xl border-2 border-cyan-200 bg-cyan-50/50 focus:outline-cyan-400" placeholder="¬øQu√© quieres lograr hoy? ‚ú®"></textarea></div>
                    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-pink-200"><h2 class="font-questrial text-2xl font-bold text-pink-500 mb-4 flex items-center gap-2"><i data-lucide="check-square"></i>To-Do List</h2><div class="space-y-3 mb-4"><input type="text" id="task-input" class="w-full p-3 rounded-2xl border-2 border-pink-200 focus:outline-pink-400" placeholder="Nueva tarea... üíï"><div class="flex gap-2"><select id="priority-select" class="flex-1 p-2 rounded-xl border-2 border-pink-200"><option value="high">‚≠ê Alta</option><option value="medium">üíñ Media</option><option value="normal" selected>‚òÅÔ∏è Normal</option></select><button id="add-task-btn" class="bg-gradient-to-r from-pink-400 to-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg transform hover:scale-105 transition"><i data-lucide="plus"></i></button></div></div><div id="tasks-container" class="space-y-2 max-h-96 overflow-y-auto"></div></div>
                </div>
                <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-purple-200">
                    <h2 class="font-questrial text-2xl font-bold text-purple-500 mb-4 flex items-center gap-2"><i data-lucide="calendar"></i>Horario</h2>
                    <div class="space-y-3 mb-4">
                        <div class="grid grid-cols-2 gap-2 text-sm text-center text-purple-600"><div>Hora de Inicio</div><div>Hora de Fin</div></div>
                        <div class="grid grid-cols-[1fr,auto,1fr,auto,1fr,auto,1fr] items-center gap-1">
                            <select id="event-start-hour" class="w-full p-2 rounded-xl border-2 border-purple-200"></select><span class="font-bold text-purple-400">:</span><select id="event-start-minute" class="w-full p-2 rounded-xl border-2 border-purple-200"></select>
                            <span class="font-bold text-gray-400 mx-1">-</span>
                            <select id="event-end-hour" class="w-full p-2 rounded-xl border-2 border-purple-200"></select><span class="font-bold text-purple-400">:</span><select id="event-end-minute" class="w-full p-2 rounded-xl border-2 border-purple-200"></select>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="event-text-input" class="flex-1 p-2 rounded-xl border-2 border-purple-200" placeholder="Evento... üéâ">
                            <button id="add-event-btn" class="bg-gradient-to-r from-purple-400 to-pink-400 text-white px-4 py-2 rounded-xl shadow-lg transform hover:scale-105 transition"><i data-lucide="plus"></i></button>
                        </div>
                    </div>
                    <div id="schedule-timeline" class="relative max-h-[600px] overflow-y-auto bg-white/50 rounded-lg">
                        </div>
                </div>
                <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-cyan-200"><h2 class="font-questrial text-2xl font-bold text-teal-500 mb-4 flex items-center gap-2"><i data-lucide="notebook-pen"></i>Notas</h2><textarea id="notes-textarea" class="w-full h-full min-h-[500px] p-4 rounded-2xl border-2 border-cyan-200 bg-cyan-50/50 focus:outline-cyan-400" placeholder="Escribe tus pensamientos aqu√≠... üåü"></textarea></div>
            </div>
            <div id="weekly-view" class="view-container hidden"><div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-pink-200"><div id="weekly-grid" class="grid grid-cols-[auto_1fr_1fr_1fr_1fr_1fr_1fr_1fr] auto-rows-fr gap-1 text-center text-sm"></div></div></div>
            <div id="monthly-view" class="view-container hidden"><div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-teal-200"><div id="monthly-grid-header" class="grid grid-cols-7 gap-2 mb-2"></div><div id="monthly-grid-days" class="grid grid-cols-7 gap-2"></div></div></div>
            <div id="yearly-view" class="view-container hidden relative">
                <div class="absolute -top-4 -left-4 text-4xl animate-pulse">‚ú®</div><div class="absolute -top-2 -right-4 text-4xl animate-bounce" style="animation-delay: 0.5s">üå∏</div><div class="absolute -bottom-4 -right-2 text-4xl animate-pulse" style="animation-delay: 0.2s">‚ú®</div><div class="absolute -bottom-2 -left-2 text-4xl animate-bounce">üå∏</div>
                <div id="yearly-grid" class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-4 border-pink-200 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. ESTADO DE LA APLICACI√ìN ---
        let currentDate = new Date();
        let dailyData = {};
        let currentView = 'daily';

        // --- 2. CONSTANTES Y REFERENCIAS AL DOM ---
        const MONTH_NAMES = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
        const DAY_NAMES = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];
        const DOM = {
            dateDisplay: document.getElementById('current-date-display'),
            viewContainers: document.querySelectorAll('.view-container'),
            viewSwitcherBtns: document.querySelectorAll('.view-btn'),
            goalsTextarea: document.getElementById('goals-textarea'),
            notesTextarea: document.getElementById('notes-textarea'),
            taskInput: document.getElementById('task-input'),
            prioritySelect: document.getElementById('priority-select'),
            tasksContainer: document.getElementById('tasks-container'),
            scheduleTimeline: document.getElementById('schedule-timeline'),
            eventStartHour: document.getElementById('event-start-hour'),
            eventStartMinute: document.getElementById('event-start-minute'),
            eventEndHour: document.getElementById('event-end-hour'),
            eventEndMinute: document.getElementById('event-end-minute'),
            eventTextInput: document.getElementById('event-text-input'),
            weeklyGrid: document.getElementById('weekly-grid'),
            monthlyHeader: document.getElementById('monthly-grid-header'),
            monthlyDays: document.getElementById('monthly-grid-days'),
            yearlyGrid: document.getElementById('yearly-grid'),
        };

        // --- 3. FUNCIONES DE DATOS ---
        const formatDateKey = (date) => date.toISOString().split('T')[0];
        const saveData = () => localStorage.setItem('merakelysiPlannerData', JSON.stringify(dailyData));
        const loadData = () => { dailyData = JSON.parse(localStorage.getItem('merakelysiPlannerData')) || {}; };
        const getDayData = (date) => {
            const key = formatDateKey(date);
            if (!dailyData[key]) dailyData[key] = { tasks: [], scheduleEvents: [], notes: '', goals: '' };
            return dailyData[key];
        };

        // --- 4. L√ìGICA DE LA APLICACI√ìN ---
        const handleAction = (action) => { action(); saveData(); renderApp(); };
        const addTask = () => handleAction(() => { /* ... (c√≥digo sin cambios) ... */ });
        const toggleTask = (taskId) => handleAction(() => { /* ... (c√≥digo sin cambios) ... */ });
        const deleteTask = (taskId) => handleAction(() => { /* ... (c√≥digo sin cambios) ... */ });
        const addEvent = () => handleAction(() => { /* ... (c√≥digo sin cambios) ... */ });
        const deleteEvent = (eventId) => handleAction(() => { /* ... (c√≥digo sin cambios) ... */ });
        const exportToTXT = () => { /* ... (c√≥digo sin cambios) ... */ };
        const exportToICS = () => { /* ... (c√≥digo sin cambios) ... */ };

        // --- 5. RENDERIZADO ---
        const renderDailyView = () => {
            const dayData = getDayData(currentDate);
            DOM.goalsTextarea.value = dayData.goals;
            DOM.notesTextarea.value = dayData.notes;
            DOM.tasksContainer.innerHTML = dayData.tasks.map(task => {
                const colors = { high: 'bg-pink-100 border-pink-300', medium: 'bg-purple-100 border-purple-300', normal: 'bg-blue-100 border-blue-300' };
                return `<div class="p-3 rounded-2xl border-2 flex items-center gap-2 ${colors[task.priority]} ${task.completed ? 'opacity-60' : ''}">
                    <button onclick="toggleTask(${task.id})" class="w-6 h-6 rounded-full border-2 flex items-center justify-center ${task.completed ? 'bg-pink-400 border-pink-400' : 'border-gray-400'}">${task.completed ? '<i data-lucide="check" class="text-white"></i>' : ''}</button>
                    <span class="flex-1 ${task.completed ? 'line-through' : ''}">${task.text}</span>
                    <button onclick="deleteTask(${task.id})" class="text-red-400 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>`;
            }).join('');

            // --- L√ìGICA DEL HORARIO COMPLETAMENTE REESCRITA ---
            const timeline = DOM.scheduleTimeline;
            timeline.innerHTML = '';
            
            let backgroundHTML = '<div class="absolute inset-0">';
            for (let hour = 0; hour < 24; hour++) {
                backgroundHTML += `
                    <div class="flex h-16">
                        <div class="w-14 text-xs font-semibold text-gray-400 text-right pr-2 -mt-2">${hour.toString().padStart(2, '0')}:00</div>
                        <div class="flex-1 border-t border-pink-200"></div>
                    </div>`;
            }
            backgroundHTML += '</div>';
            
            const minuteHeight = 64 / 60; // 64px (h-16) / 60 minutes
            let eventsHTML = dayData.scheduleEvents.map(event => {
                const [startHour, startMinute] = event.startTime.split(':').map(Number);
                const [endHour, endMinute] = event.endTime.split(':').map(Number);

                const top = (startHour * 60 + startMinute) * minuteHeight;
                const duration = (endHour * 60 + endMinute) - (startHour * 60 + startMinute);
                const height = duration * minuteHeight;

                return `
                    <div class="absolute left-14 right-0 mx-2 p-2 rounded-lg bg-gradient-to-r from-purple-300 to-pink-300 border-l-4 border-purple-500 text-white shadow-lg flex flex-col justify-between overflow-hidden"
                         style="top: ${top}px; height: ${height}px; min-height: 32px;">
                        <div>
                            <div class="font-bold text-sm">${event.text}</div>
                            <div class="text-xs">${event.startTime} - ${event.endTime}</div>
                        </div>
                        <button onclick="deleteEvent(${event.id})" class="absolute bottom-1 right-1 text-white/50 hover:text-white">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>`;
            }).join('');

            timeline.innerHTML = backgroundHTML + `<div class="relative">${eventsHTML}</div>`;
        };
        const renderWeeklyView = () => { /* ... (c√≥digo sin cambios) ... */ };
        const renderMonthlyView = () => { /* ... (c√≥digo sin cambios) ... */ };
        const renderYearlyView = () => { /* ... (c√≥digo sin cambios) ... */ };

        const renderApp = () => {
            if (currentView === 'daily') DOM.dateDisplay.textContent = currentDate.toLocaleDateString('es-MX', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            else if (currentView === 'weekly') { const start = new Date(currentDate); start.setDate(start.getDate() - start.getDay()); const end = new Date(start); end.setDate(end.getDate() + 6); DOM.dateDisplay.textContent = `Semana del ${start.getDate()}/${start.getMonth()+1} al ${end.getDate()}/${end.getMonth()+1}`; }
            else if (currentView === 'monthly') DOM.dateDisplay.textContent = `${MONTH_NAMES[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            else DOM.dateDisplay.textContent = currentDate.getFullYear();
            
            DOM.viewContainers.forEach(c => c.classList.toggle('hidden', c.id !== `${currentView}-view`));
            document.getElementById('daily-view').style.display = currentView === 'daily' ? 'grid' : 'none';
            DOM.viewSwitcherBtns.forEach(btn => {
                const view = btn.dataset.view;
                const colors = { daily: 'pink', weekly: 'purple', monthly: 'cyan', yearly: 'blue' };
                btn.className = `view-btn px-3 py-2 rounded-xl font-bold transition transform hover:scale-105 ${view === currentView ? `bg-gradient-to-r from-${colors[view]}-400 to-${colors[view]}-500 text-white shadow-lg` : `bg-white text-${colors[view]}-500 hover:bg-${colors[view]}-50`}`;
            });
            const renderers = { daily: renderDailyView, weekly: renderWeeklyView, monthly: renderMonthlyView, yearly: renderYearlyView };
            renderers[currentView]();
            lucide.createIcons();
        };

        // --- 6. INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            const populateTimeSelects = () => {
                for (let i = 0; i < 24; i++) {
                    const hour = i.toString().padStart(2, '0');
                    DOM.eventStartHour.innerHTML += `<option value="${hour}">${hour}</option>`;
                    DOM.eventEndHour.innerHTML += `<option value="${hour}">${hour}</option>`;
                }
                ['00', '30'].forEach(minute => {
                    DOM.eventStartMinute.innerHTML += `<option value="${minute}">${minute}</option>`;
                    DOM.eventEndMinute.innerHTML += `<option value="${minute}">${minute}</option>`;
                });
            };
            populateTimeSelects();

            const handleNav = (dir) => {
                if (currentView === 'daily') currentDate.setDate(currentDate.getDate() + dir);
                else if (currentView === 'weekly') currentDate.setDate(currentDate.getDate() + 7 * dir);
                else if (currentView === 'monthly') currentDate.setMonth(currentDate.getMonth() + dir);
                else currentDate.setFullYear(currentDate.getFullYear() + dir);
                renderApp();
            };
            document.getElementById('prev-btn').addEventListener('click', () => handleNav(-1));
            document.getElementById('next-btn').addEventListener('click', () => handleNav(1));
            document.getElementById('add-task-btn').addEventListener('click', addTask);
            document.getElementById('add-event-btn').addEventListener('click', addEvent);
            document.getElementById('export-txt-btn').addEventListener('click', exportToTXT);
            document.getElementById('export-ics-btn').addEventListener('click', exportToICS);
            DOM.viewSwitcherBtns.forEach(btn => btn.addEventListener('click', () => { currentView = btn.dataset.view; renderApp(); }));
            DOM.goalsTextarea.addEventListener('input', (e) => { getDayData(currentDate).goals = e.target.value; saveData(); });
            DOM.notesTextarea.addEventListener('input', (e) => { getDayData(currentDate).notes = e.target.value; saveData(); });
            DOM.taskInput.addEventListener('keypress', (e) => e.key === 'Enter' && addTask);
            DOM.eventTextInput.addEventListener('keypress', (e) => e.key === 'Enter' && addEvent);
            loadData();
            renderApp();
        });

        // --- C√ìDIGO RESTANTE (SIN CAMBIOS) ---
        addTask = () => handleAction(() => { const text = DOM.taskInput.value.trim(); if (text) { getDayData(currentDate).tasks.push({ id: Date.now(), text, completed: false, priority: DOM.prioritySelect.value }); DOM.taskInput.value = ''; } });
        toggleTask = (taskId) => handleAction(() => { const task = getDayData(currentDate).tasks.find(t => t.id === taskId); if(task) task.completed = !task.completed; });
        deleteTask = (taskId) => handleAction(() => { const dayData = getDayData(currentDate); dayData.tasks = dayData.tasks.filter(t => t.id !== taskId); });
        addEvent = () => handleAction(() => { const startTime = `${DOM.eventStartHour.value}:${DOM.eventStartMinute.value}`; const endTime = `${DOM.eventEndHour.value}:${DOM.eventEndMinute.value}`; const text = DOM.eventTextInput.value.trim(); if (text) { const dayData = getDayData(currentDate); dayData.scheduleEvents.push({ id: Date.now(), startTime, endTime, text }); dayData.scheduleEvents.sort((a, b) => a.startTime.localeCompare(b.startTime)); DOM.eventTextInput.value = ''; } });
        deleteEvent = (eventId) => handleAction(() => { const dayData = getDayData(currentDate); dayData.scheduleEvents = dayData.scheduleEvents.filter(e => e.id !== eventId); });
        exportToTXT = () => { const data = getDayData(currentDate); const dateStr = currentDate.toLocaleDateString('es-MX'); let content = `ü¶Ñ Merakelysi Planner - Resumen del ${dateStr} ü¶Ñ\n=================================================\n\n`; content += `üéØ OBJETIVOS DEL D√çA:\n${data.goals || 'No se registraron objetivos.'}\n\n`; content += `‚úÖ LISTA DE TAREAS:\n`; if (data.tasks.length > 0) { data.tasks.forEach(task => { content += `${task.completed ? '[x]' : '[ ]'} ${task.text} (Prioridad: ${task.priority})\n`; }); } else { content += `No hay tareas pendientes.\n`; } content += `\nüìÖ HORARIO:\n`; if (data.scheduleEvents.length > 0) { data.scheduleEvents.forEach(event => { content += `${event.startTime} - ${event.endTime}: ${event.text}\n`; }); } else { content += `No hay eventos agendados.\n`; } content += `\nüìù NOTAS:\n${data.notes || 'No hay notas.'}\n`; const blob = new Blob([content], { type: 'text/plain;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `planner-resumen-${formatDateKey(currentDate)}.txt`; a.click(); URL.revokeObjectURL(url); };
        exportToICS = () => { const events = getDayData(currentDate).scheduleEvents; if (events.length === 0) { alert("No hay eventos en el horario para exportar en este d√≠a."); return; } const formatICSDate = (date, time) => { const [year, month, day] = [date.getFullYear(), date.getMonth(), date.getDate()]; const [hour, minute] = time.split(':'); const localDate = new Date(year, month, day, hour, minute); return localDate.toISOString().replace(/[-:.]/g, '').slice(0, 15) + 'Z'; }; let icsContent = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Merakelysi Planner//EN']; events.forEach(event => { icsContent.push('BEGIN:VEVENT', `UID:${Date.now()}${Math.random().toString(16).substr(2, 8)}@merakelysi.planner`, `DTSTAMP:${new Date().toISOString().replace(/[-:.]/g, '').slice(0, 15) + 'Z'}`, `DTSTART:${formatICSDate(currentDate, event.startTime)}`, `DTEND:${formatICSDate(currentDate, event.endTime)}`, `SUMMARY:${event.text}`, `DESCRIPTION:Evento agendado desde Merakelysi Planner.`, 'END:VEVENT'); }); icsContent.push('END:VCALENDAR'); const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `evento-${formatDateKey(currentDate)}.ics`; a.click(); URL.revokeObjectURL(url); };
        renderWeeklyView = () => { let html = `<div class="font-questrial font-bold p-2 text-teal-700">HORA</div>`; const weekDays = Array.from({length: 7}, (_, i) => { const d = new Date(currentDate); d.setDate(d.getDate() - d.getDay() + i); return d; }); weekDays.forEach((day, i) => { const eventCount = getDayData(day).scheduleEvents.length; const eventIndicator = eventCount > 0 ? `<span class="font-normal text-purple-500">(${eventCount})</span>` : ''; html += `<div class="font-questrial p-2 rounded-lg border-2 ${day.toDateString() === new Date().toDateString() ? 'bg-pink-300 text-white' : 'bg-pink-100'}">${DAY_NAMES[i]}<br>${day.getDate()} ${eventIndicator}</div>`; }); for (let hour = 0; hour < 24; hour++) { html += `<div class="font-semibold p-2 bg-cyan-50 rounded-lg">${hour.toString().padStart(2, '0')}:00</div>`; weekDays.forEach(day => { const eventsHTML = getDayData(day).scheduleEvents.filter(e => parseInt(e.startTime.split(':')[0]) === hour).map(e => `<div class="text-xs bg-purple-200 p-1 rounded mb-1 truncate">${e.text}</div>`).join(''); html += `<div class="border border-pink-100 min-h-[40px] p-1">${eventsHTML}</div>`; }); } DOM.weeklyGrid.innerHTML = html; };
        renderMonthlyView = () => { DOM.monthlyHeader.innerHTML = DAY_NAMES.map(day => `<div class="font-questrial font-bold text-center text-teal-700">${day}</div>`).join(''); const year = currentDate.getFullYear(), month = currentDate.getMonth(); const firstDay = new Date(year, month, 1), lastDay = new Date(year, month + 1, 0); let daysHTML = Array(firstDay.getDay()).fill('<div></div>').join(''); for (let day = 1; day <= lastDay.getDate(); day++) { const date = new Date(year, month, day); const isToday = date.toDateString() === new Date().toDateString(); const dayData = getDayData(date); const taskCount = dayData.tasks.length; const events = dayData.scheduleEvents; const taskIndicator = taskCount > 0 ? `<div class="text-xs text-pink-500 mt-1">üå∏ ${taskCount} tareas</div>` : ''; const eventIndicator = events.slice(0, 2).map(event => `<div class="text-xs bg-purple-200 text-purple-800 p-1 rounded-md truncate mt-1"><span class="font-semibold">${event.startTime}</span> ${event.text}</div>`).join(''); const bgColor = isToday ? 'bg-pink-300' : 'bg-teal-100/50'; const borderColor = isToday ? 'border-pink-400' : 'border-teal-200'; const textColor = isToday ? 'text-white' : 'text-teal-800'; daysHTML += `<div class="p-2 border-2 rounded-lg min-h-[120px] transition hover:shadow-md hover:border-teal-400 ${bgColor} ${borderColor}"><div class="font-bold ${textColor}">${day}</div><div class="space-y-1">${taskIndicator}${eventIndicator}</div></div>`; } DOM.monthlyDays.innerHTML = daysHTML; };
        renderYearlyView = () => { const year = currentDate.getFullYear(); DOM.yearlyGrid.innerHTML = MONTH_NAMES.map((name, i) => { let totalEventsThisMonth = 0; const daysInMonth = new Date(year, i + 1, 0).getDate(); for (let day = 1; day <= daysInMonth; day++) { totalEventsThisMonth += getDayData(new Date(year, i, day)).scheduleEvents.length; } const eventIndicator = totalEventsThisMonth > 0 ? `<div class="text-sm text-purple-600 mt-1 flex items-center justify-center gap-1"><i data-lucide="calendar" class="w-4 h-4"></i> ${totalEventsThisMonth} eventos</div>` : ''; const isCurrentMonth = i === new Date().getMonth() && year === new Date().getFullYear(); const bgColor = isCurrentMonth ? 'bg-pink-300' : 'bg-cyan-100/70'; const borderColor = isCurrentMonth ? 'border-pink-400' : 'border-pink-200'; const textColor = isCurrentMonth ? 'text-white' : 'text-cyan-800'; return `<div class="h-32 p-4 rounded-2xl border-4 text-center font-bold transition hover:shadow-lg hover:scale-105 flex flex-col justify-center items-center ${bgColor} ${borderColor} ${textColor}"><span class="font-questrial text-2xl">${name}</span>${eventIndicator}</div>` }).join(''); };
    </script>
</body>
</html>
